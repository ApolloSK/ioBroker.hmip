"use strict";var I=Object.defineProperty;var g=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var D=(s,t,e)=>t in s?I(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,M=(s,t)=>{for(var e in t||(t={}))O.call(t,e)&&D(s,e,t[e]);if(g)for(var e of g(t))j.call(t,e)&&D(s,e,t[e]);return s};var R=(s,t)=>{var e={};for(var n in s)O.call(s,n)&&t.indexOf(n)<0&&(e[n]=s[n]);if(s!=null&&g)for(var n of g(s))t.indexOf(n)<0&&j.call(s,n)&&(e[n]=s[n]);return e};(self.webpackChunkiobroker_admin_component_hmip=self.webpackChunkiobroker_admin_component_hmip||[]).push([["src_Components_jsx-node_modules_mui_system_esm_RtlProvider_index_js-node_modules_mui_system_e-44e065","node_modules_mui_system_esm_useThemeWithoutDefault_useThemeWithoutDefault_js-_37310","node_modules_mui_system_esm_useThemeWithoutDefault_useThemeWithoutDefault_js-_37311"],{977:(s,t,e)=>{e.r(t),e.d(t,{default:()=>x});var n=e(4819),r=e.n(n),_=e(5854),a=e.n(_),m=e(2382),h=e(4427),p=e(5975),i=e(8844),c=(f,o,l)=>new Promise((v,T)=>{var C=d=>{try{k(l.next(d))}catch(P){T(P)}},E=d=>{try{k(l.throw(d))}catch(P){T(P)}},k=d=>d.done?v(d.value):Promise.resolve(d.value).then(C,E);k((l=l.apply(f,o)).next())});class u extends i.ConfigGeneric{constructor(o){var l;super(o),this.alive=!1,Object.assign(this.state,{response:"",running:!1,initialized:!1,error:!1,delayLoading:!0}),this.socket=((l=this.props.oContext)==null?void 0:l.socket)||this.props.socket,this.instance=this.props.oContext?this.props.oContext.instance:this.props.instance}componentDidMount(){super.componentDidMount(),setTimeout(()=>{this.setState({delayLoading:!1})},1e3)}componentWillUnmount(){super.componentWillUnmount(),this.askTimeout&&(clearTimeout(this.askTimeout),this.askTimeout=null)}askState(){return c(this,null,function*(){const o=yield this.socket.sendTo(`hmip.${this.instance}`,"requestTokenState",null);this.handleResponse(o)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}handleResponse(o){switch(o.state){case"startedTokenCreation":return this.setState({response:"started token creation",running:!0}),!0;case"waitForBlueButton":return this.setState({response:"press blue button on accesspoint",running:!0}),!0;case"confirmToken":return this.setState({response:"confirming token",running:!0}),!0;case"errorOccurred":this.setState({response:"error occurred during token generation, look at the logs",running:!1,error:!0});break;case"idle":this.setState({response:'press "request token"',running:!1});break;case"tokenCreated":{this.setState({response:"token created, save settings to use your accesspoint",running:!1}),i.ConfigGeneric.setValue(this.props.data,"authToken",o.authToken),i.ConfigGeneric.setValue(this.props.data,"clientAuthToken",o.clientAuthToken),i.ConfigGeneric.setValue(this.props.data,"clientId",o.clientId),this.props.onChange(this.props.data,void 0,()=>this.props.forceUpdate(["authToken","clientAuthToken","clientId"],this.props.data));break}}return!1}requestToken(){this.setState({response:"started token creation",running:!0,error:!1},()=>c(this,null,function*(){const o={accessPointSgtin:i.ConfigGeneric.getValue(this.props.data,"accessPointSgtin"),clientId:i.ConfigGeneric.getValue(this.props.data,"clientId"),pin:i.ConfigGeneric.getValue(this.props.data,"pin")||"",deviceName:i.ConfigGeneric.getValue(this.props.data,"deviceName")},l=yield this.socket.sendTo(`hmip.${this.instance}`,"requestToken",o);this.handleResponse(l)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))}))}renderItem(){var o,l,v,T,C;if(this.alive!==this.props.alive&&(this.alive=this.props.alive,this.alive&&!this.state.initialized&&setTimeout(()=>this.setState({initialized:!0},()=>this.askState(),100))),this.state.delayLoading||!((o=this.props.oContext)!=null&&o.theme)&&!this.props.theme)return r().createElement("div",null,"...");if(!this.props.alive&&!this.state.initialized)return r().createElement(m.Z,{theme:((l=this.props.oContext)==null?void 0:l.theme)||this.props.theme},r().createElement("div",{className:"hmip-admin-component"},p.I18n.t("custom_hmip_not_alive")));if(!this.state.initialized)return r().createElement(m.Z,{theme:((v=this.props.oContext)==null?void 0:v.theme)||this.props.theme,className:"hmip-admin-component"},r().createElement(h.LinearProgress,null));const E=i.ConfigGeneric.getValue(this.props.data,"accessPointSgtin");return r().createElement(m.Z,{theme:((T=this.props.oContext)==null?void 0:T.theme)||this.props.theme},r().createElement("div",{style:{width:"100%"},className:"hmip-admin-component"},r().createElement("div",{style:{color:this.state.error?(((C=this.props.oContext)==null?void 0:C.themeType)||this.props.themeType)==="dark"?"#c20000":"#800000":void 0}},p.I18n.t(`custom_hmip_${this.state.response}`).replace("custom_hmip_","")),r().createElement(h.Button,{variant:"contained",color:"primary",disabled:this.state.running||!E,onClick:()=>this.requestToken()},this.state.running?r().createElement(h.CircularProgress,{size:24}):p.I18n.t("custom_hmip_request_token"))))}}u.propTypes={socket:a().object.isRequired,themeType:a().string,themeName:a().string,oContext:a().object,style:a().object,className:a().string,data:a().object.isRequired,attr:a().string,schema:a().object,onError:a().func,onChange:a().func};const x={HmipComponent:u}},5838:(s,t,e)=>{e.d(t,{V:()=>i,Z:()=>c});var n=e(4819),r=e.n(n),_=e(5854),a=e.n(_),m=e(7557);const h=n.createContext();function p(x){var f=x,{value:u}=f,y=R(f,["value"]);return(0,m.jsx)(h.Provider,M({value:u!=null?u:!0},y))}const i=()=>{const u=n.useContext(h);return u!=null?u:!1},c=p},1295:(s,t,e)=>{e.d(t,{Z:()=>p});var n=e(4819),r=e.n(n),_=e(4469),a=e.n(_);function m(i){return Object.keys(i).length===0}function h(i=null){const c=n.useContext(_.ThemeContext);return!c||m(c)?i:c}const p=h}}]);

//# sourceMappingURL=src_Components_jsx-node_modules_mui_system_esm_RtlProvider_index_js-node_modules_mui_system_e-44e065.d1b3dd8e.chunk.js.map