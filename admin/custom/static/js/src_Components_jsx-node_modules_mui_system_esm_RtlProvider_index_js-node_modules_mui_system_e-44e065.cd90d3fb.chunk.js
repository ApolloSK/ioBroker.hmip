"use strict";var W=Object.defineProperty;var T=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var S=(n,s,e)=>s in n?W(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e,j=(n,s)=>{for(var e in s||(s={}))D.call(s,e)&&S(n,e,s[e]);if(T)for(var e of T(s))O.call(s,e)&&S(n,e,s[e]);return n};var M=(n,s)=>{var e={};for(var i in n)D.call(n,i)&&s.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&T)for(var i of T(n))s.indexOf(i)<0&&O.call(n,i)&&(e[i]=n[i]);return e};(self.webpackChunkiobroker_admin_component_hmip=self.webpackChunkiobroker_admin_component_hmip||[]).push([["src_Components_jsx-node_modules_mui_system_esm_RtlProvider_index_js-node_modules_mui_system_e-44e065","node_modules_mui_system_esm_useThemeWithoutDefault_useThemeWithoutDefault_js-_37310","node_modules_mui_system_esm_useThemeWithoutDefault_useThemeWithoutDefault_js-_37311"],{977:function(n,s,e){e.r(s),e.d(s,{default:function(){return R}});var i=e(4819),a=e.n(i),_=e(5854),o=e.n(_),d=e(2382),l=e(4427),c=e(5975),u=e(8844),h=Object.defineProperty,C=(m,t,r)=>t in m?h(m,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[t]=r,P=(m,t,r)=>(C(m,typeof t!="symbol"?t+"":t,r),r),v=(m,t,r)=>new Promise((g,f)=>{var x=p=>{try{E(r.next(p))}catch(k){f(k)}},A=p=>{try{E(r.throw(p))}catch(k){f(k)}},E=p=>p.done?g(p.value):Promise.resolve(p.value).then(x,A);E((r=r.apply(m,t)).next())});class y extends u.ConfigGeneric{constructor(t){super(t),P(this,"onAliveChanged",(r,g)=>{const f=g?g.val:!1;f!==this.state.alive&&this.setState({alive:f},()=>{f&&!this.state.initialized&&setTimeout(()=>this.setState({initialized:!0},()=>this.askState(),100))})}),Object.assign(this.state,{response:!1,running:!1,initialized:!1,alive:!1,error:!1,theme:(0,c.Theme)(this.props.themeName||"light")})}componentDidMount(){super.componentDidMount();const t=this.props.socket.getState(`hmip.${this.props.instance}.alive`);t!=null&&t.val&&this.setState({alive:!0,initialized:!0},()=>this.askState()),this.props.socket.subscribeState(`system.adapter.hmip.${this.props.instance}.alive`,this.onAliveChanged)}componentWillUnmount(){super.componentWillUnmount(),this.props.socket.unsubscribeState(`system.adapter.hmip.${this.props.instance}.alive`,this.onAliveChanged),this.askTimeout&&(clearTimeout(this.askTimeout),this.askTimeout=null)}askState(){return v(this,null,function*(){const t=yield this.props.socket.sendTo(`hmip.${this.props.instance}`,"requestTokenState",null);this.handleResponse(t)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}handleResponse(t){switch(t.state){case"startedTokenCreation":return this.setState({response:"started token creation",running:!0}),!0;case"waitForBlueButton":return this.setState({response:"press blue button on accesspoint",running:!0}),!0;case"confirmToken":return this.setState({response:"confirming token",running:!0}),!0;case"errorOccurred":this.setState({response:"error occurred during token generation, look at the logs",running:!1,error:!0});break;case"idle":this.setState({response:'press "request token"',running:!1});break;case"tokenCreated":{this.setState({response:"token created, save settings to use your accesspoint",running:!1}),u.ConfigGeneric.setValue(this.props.data,"authToken",t.authToken),u.ConfigGeneric.setValue(this.props.data,"clientAuthToken",t.clientAuthToken),u.ConfigGeneric.setValue(this.props.data,"clientId",t.clientId),this.props.onChange(this.props.data,void 0,()=>this.props.forceUpdate(["authToken","clientAuthToken","clientId"],this.props.data));break}}return!1}requestToken(){return v(this,null,function*(){const t={accessPointSgtin:u.ConfigGeneric.getValue(this.props.data,"accessPointSgtin"),clientId:u.ConfigGeneric.getValue(this.props.data,"clientId"),pin:u.ConfigGeneric.getValue(this.props.data,"pin")||"",deviceName:u.ConfigGeneric.getValue(this.props.data,"deviceName")};this.setState({response:"started token creation",running:!0,error:!1});const r=yield this.props.socket.sendTo(`hmip.${this.props.instance}`,"requestToken",t);this.handleResponse(r)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}renderItem(){if(!this.state.alive&&!this.state.initialized)return a().createElement(d.Z,{theme:this.state.theme},a().createElement("div",null,c.I18n.t("custom_hmip_not_alive")));if(!this.state.initialized)return a().createElement(d.Z,{theme:this.state.theme},a().createElement(l.LinearProgress,null));const t=u.ConfigGeneric.getValue(this.props.data,"accessPointSgtin");return a().createElement(d.Z,{theme:this.state.theme},a().createElement("div",{style:{width:"100%"},className:"hmip-admin-component"},a().createElement("div",{style:{color:this.state.error?this.props.themeType==="dark"?"#c20000":"#800000":void 0}},c.I18n.t(`custom_hmip_${this.state.response}`).replace("custom_hmip_","")),a().createElement(l.Button,{variant:"contained",color:"primary",disabled:this.state.running||!t,onClick:()=>this.requestToken()},this.state.running?a().createElement(l.CircularProgress,{size:24}):c.I18n.t("custom_hmip_request_token"))))}}y.propTypes={socket:o().object.isRequired,themeType:o().string,themeName:o().string,style:o().object,className:o().string,data:o().object.isRequired,attr:o().string,schema:o().object,onError:o().func,onChange:o().func};var I=y,R={HmipComponent:I}},5838:function(n,s,e){e.d(s,{V:function(){return u}});var i=e(4819),a=e.n(i),_=e(5854),o=e.n(_),d=e(7557);const l=i.createContext();function c(P){var v=P,{value:h}=v,C=M(v,["value"]);return(0,d.jsx)(l.Provider,j({value:h!=null?h:!0},C))}const u=()=>{const h=i.useContext(l);return h!=null?h:!1};s.Z=c},1295:function(n,s,e){var i=e(4819),a=e.n(i),_=e(7196);function o(l){return Object.keys(l).length===0}function d(l=null){const c=i.useContext(_.T);return!c||o(c)?l:c}s.Z=d}}]);

//# sourceMappingURL=src_Components_jsx-node_modules_mui_system_esm_RtlProvider_index_js-node_modules_mui_system_e-44e065.cd90d3fb.chunk.js.map