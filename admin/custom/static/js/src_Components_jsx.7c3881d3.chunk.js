"use strict";(self.webpackChunkiobroker_admin_component_hmip=self.webpackChunkiobroker_admin_component_hmip||[]).push([["src_Components_jsx"],{71412:function(I,d,i){i.r(d),i.d(d,{default:function(){return P}});var g=i(4819),o=i.n(g),v=i(15854),n=i.n(v),k=i(58503),u=i(94427),t=i(75606),T=Object.defineProperty,C=(a,e,s)=>e in a?T(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,S=(a,e,s)=>(C(a,typeof e!="symbol"?e+"":e,s),s),m=(a,e,s)=>new Promise((c,l)=>{var j=r=>{try{p(s.next(r))}catch(h){l(h)}},G=r=>{try{p(s.throw(r))}catch(h){l(h)}},p=r=>r.done?c(r.value):Promise.resolve(r.value).then(j,G);p((s=s.apply(a,e)).next())});const y=()=>({});class f extends t.ConfigGeneric{constructor(e){super(e),S(this,"onAliveChanged",(s,c)=>{const l=c?c.val:!1;l!==this.state.alive&&this.setState({alive:l},()=>{l&&!this.state.initialized&&setTimeout(()=>this.setState({initialized:!0},()=>this.askState(),100))})}),this.state={response:!1,running:!1,initialized:!1,alive:!1,error:!1}}componentDidMount(){super.componentDidMount();const e=this.props.socket.getState(`hmip.${this.props.instance}.alive`);e&&e.val&&this.setState({alive:!0,initialized:!0},()=>this.askState()),this.props.socket.subscribeState(`system.adapter.hmip.${this.props.instance}.alive`,this.onAliveChanged)}componentWillUnmount(){super.componentWillUnmount(),this.props.socket.unsubscribeState(`system.adapter.hmip.${this.props.instance}.alive`,this.onAliveChanged),this.askTimeout&&(clearTimeout(this.askTimeout),this.askTimeout=null)}askState(){return m(this,null,function*(){const e=yield this.props.socket.sendTo(`hmip.${this.props.instance}`,"requestTokenState",null);this.handleResponse(e)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}handleResponse(e){switch(e.state){case"startedTokenCreation":return this.setState({response:"started token creation",running:!0}),!0;case"waitForBlueButton":return this.setState({response:"press blue button on accesspoint",running:!0}),!0;case"confirmToken":return this.setState({response:"confirming token",running:!0}),!0;case"errorOccurred":this.setState({response:"error occurred during token generation, look at the logs",running:!1,error:!0});break;case"idle":this.setState({response:'press "request token"',running:!1});break;case"tokenCreated":{this.setState({response:"token created, save settings to use your accesspoint",running:!1}),t.ConfigGeneric.setValue(this.props.data,"authToken",e.authToken),t.ConfigGeneric.setValue(this.props.data,"clientAuthToken",e.clientAuthToken),t.ConfigGeneric.setValue(this.props.data,"clientId",e.clientId),this.props.onChange(this.props.data,void 0,()=>this.props.forceUpdate(["authToken","clientAuthToken","clientId"],this.props.data));break}}return!1}requestToken(){return m(this,null,function*(){const e={accessPointSgtin:t.ConfigGeneric.getValue(this.props.data,"accessPointSgtin"),clientId:t.ConfigGeneric.getValue(this.props.data,"clientId"),pin:t.ConfigGeneric.getValue(this.props.data,"pin"),deviceName:t.ConfigGeneric.getValue(this.props.data,"deviceName")};this.setState({response:"started token creation",running:!0,error:!1});const s=yield this.props.socket.sendTo(`hmip.${this.props.instance}`,"requestToken",e);this.handleResponse(s)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}renderItem(){if(!this.state.alive&&!this.state.initialized)return o().createElement("div",null,t.I18n.t("custom_hmip_not_alive"));if(this.state.initialized){const e={accessPointSgtin:t.ConfigGeneric.getValue(this.props.data,"accessPointSgtin"),pin:t.ConfigGeneric.getValue(this.props.data,"pin")};return o().createElement("div",{style:{width:"100%"}},o().createElement("div",{style:{color:this.state.error?this.props.themeType==="dark"?"#c20000":"#800000":void 0}},t.I18n.t(`custom_hmip_${this.state.response}`).replace("custom_hmip_","")),o().createElement(u.Button,{variant:"contained",color:"primary",disabled:this.state.running||!e.accessPointSgtin||!e.pin,onClick:()=>this.requestToken()},this.state.running?o().createElement(u.CircularProgress,{size:22}):t.I18n.t("custom_hmip_request_token")))}else return o().createElement(u.LinearProgress,null)}}f.propTypes={socket:n().object.isRequired,themeType:n().string,themeName:n().string,style:n().object,className:n().string,data:n().object.isRequired,attr:n().string,schema:n().object,onError:n().func,onChange:n().func};var b=(0,k.withStyles)(y)(f),P={HmipComponent:b}}}]);

//# sourceMappingURL=src_Components_jsx.7c3881d3.chunk.js.map