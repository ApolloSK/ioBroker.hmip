"use strict";var M=Object.defineProperty;var g=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var P=(s,t,e)=>t in s?M(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,O=(s,t)=>{for(var e in t||(t={}))D.call(t,e)&&P(s,e,t[e]);if(g)for(var e of g(t))x.call(t,e)&&P(s,e,t[e]);return s};var j=(s,t)=>{var e={};for(var n in s)D.call(s,n)&&t.indexOf(n)<0&&(e[n]=s[n]);if(s!=null&&g)for(var n of g(s))t.indexOf(n)<0&&x.call(s,n)&&(e[n]=s[n]);return e};(self.webpackChunkiobroker_admin_component_hmip=self.webpackChunkiobroker_admin_component_hmip||[]).push([["src_Components_jsx-node_modules_mui_system_esm_RtlProvider_index_js-node_modules_mui_system_e-44e065","node_modules_mui_system_esm_useThemeWithoutDefault_useThemeWithoutDefault_js-_37310","node_modules_mui_system_esm_useThemeWithoutDefault_useThemeWithoutDefault_js-_37311"],{977:(s,t,e)=>{e.r(t),e.d(t,{default:()=>k});var n=e(4819),i=e.n(n),f=e(5854),l=e.n(f),d=e(2382),m=e(4427),h=e(5975),o=e(8844),p=(T,a,r)=>new Promise((u,y)=>{var R=_=>{try{v(r.next(_))}catch(E){y(E)}},I=_=>{try{v(r.throw(_))}catch(E){y(E)}},v=_=>_.done?u(_.value):Promise.resolve(_.value).then(R,I);v((r=r.apply(T,a)).next())});class c extends o.ConfigGeneric{constructor(a){var r;super(a),this.alive=!1,Object.assign(this.state,{response:"",running:!1,initialized:!1,error:!1,delayLoading:!0}),this.socket=((r=this.props.oContext)==null?void 0:r.socket)||this.props.socket,this.instance=this.props.oContext?this.props.oContext.instance:this.props.instance,this.themeType=this.props.oContext?this.props.oContext.themeType:this.props.themeType,this.theme=(0,h.Theme)(this.props.themeName)}componentDidMount(){super.componentDidMount(),setTimeout(()=>{this.setState({delayLoading:!1})},1e3)}componentWillUnmount(){super.componentWillUnmount(),this.askTimeout&&(clearTimeout(this.askTimeout),this.askTimeout=null)}askState(){return p(this,null,function*(){const a=yield this.socket.sendTo(`hmip.${this.instance}`,"requestTokenState",null);this.handleResponse(a)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}handleResponse(a){switch(a.state){case"startedTokenCreation":return this.setState({response:"started token creation",running:!0}),!0;case"waitForBlueButton":return this.setState({response:"press blue button on accesspoint",running:!0}),!0;case"confirmToken":return this.setState({response:"confirming token",running:!0}),!0;case"errorOccurred":this.setState({response:"error occurred during token generation, look at the logs",running:!1,error:!0});break;case"idle":this.setState({response:'press "request token"',running:!1});break;case"tokenCreated":{this.setState({response:"token created, save settings to use your accesspoint",running:!1}),o.ConfigGeneric.setValue(this.props.data,"authToken",a.authToken),o.ConfigGeneric.setValue(this.props.data,"clientAuthToken",a.clientAuthToken),o.ConfigGeneric.setValue(this.props.data,"clientId",a.clientId),this.props.onChange(this.props.data,void 0,()=>{var r;const u=((r=this.props.oContext)==null?void 0:r.forceUpdate)||this.props.forceUpdate;u&&u(["authToken","clientAuthToken","clientId"],this.props.data)});break}}return!1}requestToken(){this.setState({response:"started token creation",running:!0,error:!1},()=>p(this,null,function*(){const a={accessPointSgtin:o.ConfigGeneric.getValue(this.props.data,"accessPointSgtin"),clientId:o.ConfigGeneric.getValue(this.props.data,"clientId"),pin:o.ConfigGeneric.getValue(this.props.data,"pin")||"",deviceName:o.ConfigGeneric.getValue(this.props.data,"deviceName")},r=yield this.socket.sendTo(`hmip.${this.instance}`,"requestToken",a);this.handleResponse(r)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))}))}renderItem(){var a;if(this.alive!==this.props.alive&&(this.alive=this.props.alive,this.alive&&!this.state.initialized&&setTimeout(()=>this.setState({initialized:!0},()=>this.askState(),100))),this.state.delayLoading||!((a=this.props.oContext)!=null&&a.theme)&&!this.props.theme)return i().createElement("div",null,"...");if(!this.props.alive&&!this.state.initialized)return i().createElement(d.Z,{theme:this.theme},i().createElement("div",{className:"hmip-admin-component"},h.I18n.t("custom_hmip_not_alive")));if(!this.state.initialized)return i().createElement(d.Z,{theme:this.theme,className:"hmip-admin-component"},i().createElement(m.LinearProgress,null));const r=o.ConfigGeneric.getValue(this.props.data,"accessPointSgtin");let u=null;return this.state.response==='press "request token"'&&(u=h.I18n.t("custom_hmip_press_hcu_button").split('"Home Control Unit"'),u.length===2?u=i().createElement("div",{style:{width:"100%"}},i().createElement("span",null,u[0]),i().createElement("span",{style:{marginLeft:1,marginRight:1,fontWeight:600,color:this.themeType==="dark"?"#0091c5":"#004b61"}},'"Home Control Unit"'),i().createElement("span",null,u[1])):u=i().createElement("div",{style:{width:"100%"}},h.I18n.t("custom_hmip_press_hcu_button"))),i().createElement(d.Z,{theme:this.theme},i().createElement("div",{style:{width:"100%"},className:"hmip-admin-component"},u,i().createElement("div",{style:{color:this.state.error?this.themeType==="dark"?"#c20000":"#800000":void 0,marginBottom:8}},h.I18n.t(`custom_hmip_${this.state.response}`).replace("custom_hmip_","")),i().createElement(m.Button,{variant:"contained",color:"primary",disabled:this.state.running||!r,onClick:()=>this.requestToken()},this.state.running?i().createElement(m.CircularProgress,{size:24}):h.I18n.t("custom_hmip_request_token"))))}}c.propTypes={socket:l().object.isRequired,themeType:l().string,themeName:l().string,oContext:l().object,style:l().object,className:l().string,data:l().object.isRequired,attr:l().string,schema:l().object,onError:l().func,onChange:l().func};const k={HmipComponent:c}},5838:(s,t,e)=>{e.d(t,{V:()=>o,Z:()=>p});var n=e(4819),i=e.n(n),f=e(5854),l=e.n(f),d=e(7557);const m=n.createContext();function h(k){var T=k,{value:c}=T,C=j(T,["value"]);return(0,d.jsx)(m.Provider,O({value:c!=null?c:!0},C))}const o=()=>{const c=n.useContext(m);return c!=null?c:!1},p=h},1295:(s,t,e)=>{e.d(t,{Z:()=>h});var n=e(4819),i=e.n(n),f=e(4469),l=e.n(f);function d(o){return Object.keys(o).length===0}function m(o=null){const p=n.useContext(f.ThemeContext);return!p||d(p)?o:p}const h=m}}]);

//# sourceMappingURL=src_Components_jsx-node_modules_mui_system_esm_RtlProvider_index_js-node_modules_mui_system_e-44e065.5e5dc36f.chunk.js.map