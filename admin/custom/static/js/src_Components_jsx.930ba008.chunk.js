(self.webpackChunkiobroker_admin_component_hmip=self.webpackChunkiobroker_admin_component_hmip||[]).push([["src_Components_jsx"],{34175:(E,p,o)=>{"use strict";o.r(p),o.d(p,{default:()=>C});var s=o(77810),g=o(75826),i=o.n(g),k=o(57129),v=o(88710),T=o(60350),l=o(17739),r=o(3849),u=(d,t,e)=>new Promise((n,f)=>{var y=a=>{try{c(e.next(a))}catch(h){f(h)}},S=a=>{try{c(e.throw(a))}catch(h){f(h)}},c=a=>a.done?n(a.value):Promise.resolve(a.value).then(y,S);c((e=e.apply(d,t)).next())});class m extends r.ConfigGeneric{constructor(t){var e;super(t),this.alive=!1,Object.assign(this.state,{response:"",running:!1,initialized:!1,error:!1}),this.socket=((e=this.props.oContext)==null?void 0:e.socket)||this.props.socket,this.instance=this.props.oContext?this.props.oContext.instance:this.props.instance,this.themeType=this.props.oContext?this.props.oContext.themeType:this.props.themeType}componentWillUnmount(){super.componentWillUnmount(),this.askTimeout&&(clearTimeout(this.askTimeout),this.askTimeout=null)}askState(){return u(this,null,function*(){const t=yield this.socket.sendTo(`hmip.${this.instance}`,"requestTokenState",null);this.handleResponse(t)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))})}handleResponse(t){switch(t.state){case"startedTokenCreation":return this.setState({response:"started token creation",running:!0}),!0;case"waitForBlueButton":return this.setState({response:"press blue button on accesspoint",running:!0}),!0;case"confirmToken":return this.setState({response:"confirming token",running:!0}),!0;case"errorOccurred":this.setState({response:"error occurred during token generation, look at the logs",running:!1,error:!0});break;case"idle":this.setState({response:'press "request token"',running:!1});break;case"tokenCreated":{this.setState({response:"token created, save settings to use your accesspoint",running:!1}),r.ConfigGeneric.setValue(this.props.data,"authToken",t.authToken),r.ConfigGeneric.setValue(this.props.data,"clientAuthToken",t.clientAuthToken),r.ConfigGeneric.setValue(this.props.data,"clientId",t.clientId),this.props.onChange(this.props.data,void 0,()=>{var e;const n=((e=this.props.oContext)==null?void 0:e.forceUpdate)||this.props.forceUpdate;n&&n(["authToken","clientAuthToken","clientId"],this.props.data)});break}}return!1}requestToken(){this.setState({response:"started token creation",running:!0,error:!1},()=>u(this,null,function*(){const t={accessPointSgtin:r.ConfigGeneric.getValue(this.props.data,"accessPointSgtin"),clientId:r.ConfigGeneric.getValue(this.props.data,"clientId"),pin:r.ConfigGeneric.getValue(this.props.data,"pin")||"",deviceName:r.ConfigGeneric.getValue(this.props.data,"deviceName")},e=yield this.socket.sendTo(`hmip.${this.instance}`,"requestToken",t);this.handleResponse(e)&&(this.askTimeout=this.askTimeout||setTimeout(()=>{this.askTimeout=null,this.askState()},300))}))}renderItem(){var t;if(this.alive!==this.props.alive&&(this.alive=this.props.alive,this.alive&&!this.state.initialized&&setTimeout(()=>this.setState({initialized:!0},()=>this.askState(),100))),!((t=this.props.oContext)!=null&&t.theme)&&!this.props.theme)return s.createElement("div",null,"...");if(!this.props.alive&&!this.state.initialized)return s.createElement("div",{className:"hmip-admin-component"},l.I18n.t("custom_hmip_not_alive"));if(!this.state.initialized)return s.createElement(k.A,null);const e=r.ConfigGeneric.getValue(this.props.data,"accessPointSgtin");let n=null;return this.state.response==='press "request token"'&&(n=l.I18n.t("custom_hmip_press_hcu_button").split('"Home Control Unit"'),n.length===2?n=s.createElement("div",{style:{width:"100%"}},s.createElement("span",null,n[0]),s.createElement("span",{style:{marginLeft:1,marginRight:1,fontWeight:600,color:this.themeType==="dark"?"#0091c5":"#004b61"}},'"Home Control Unit"'),s.createElement("span",null,n[1])):n=s.createElement("div",{style:{width:"100%"}},l.I18n.t("custom_hmip_press_hcu_button"))),s.createElement("div",{style:{width:"100%"},className:"hmip-admin-component"},n,s.createElement("div",{style:{color:this.state.error?this.themeType==="dark"?"#c20000":"#800000":void 0,marginBottom:8}},l.I18n.t(`custom_hmip_${this.state.response}`).replace("custom_hmip_","")),s.createElement(v.A,{variant:"contained",color:"primary",disabled:this.state.running||!e,onClick:()=>this.requestToken()},this.state.running?s.createElement(T.A,{size:24}):l.I18n.t("custom_hmip_request_token")))}}m.propTypes={socket:i().object.isRequired,themeType:i().string,themeName:i().string,oContext:i().object,style:i().object,className:i().string,data:i().object.isRequired,attr:i().string,schema:i().object,onError:i().func,onChange:i().func};const C={HmipComponent:m}},50477:()=>{}}]);

//# sourceMappingURL=src_Components_jsx.930ba008.chunk.js.map